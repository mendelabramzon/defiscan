from web3 import Web3
from web3.middleware import geth_poa_middleware
import time
import numpy as np
matic = Web3(Web3.HTTPProvider('https://muddy-white-glade.matic.quiknode.pro//'))
matic.middleware_onion.inject(geth_poa_middleware, layer=0)
accounts = ['0x46C11062B48156f8836a8977469F7dEd905BF7C8','0xCC484E81F6C6F14A685Fda8CB808534B9638d796','0x8B2f6EecD0e3C515DA7853F0a0CB176c9887Ca1A','0xb23A8E4150960857b72Ab7eCFBfa23959D44D6b2',
'0x6B581ed4a9D1079DF608183A4E0Ce60F96C96e2d','0xFa931cE1AB7F0F019F261dc733b25af27fe5f9E3','0x361c775Af56677Ba879fbB8Cd9bA361a81DCa287','0xaaac586a4bdfe4C48723f7b8235d2894f80A66f9',
'0x1Eaca117b0a1e369263142B184A8B4bA37B89acf','0xD6E95262EE709bC7887cCe3aDF1cE7ae1997B774','0x840b7199Ee12bf266deF7903FEc1e09c6A9d9a03','0x2bD8AC10c5d694e56b3Fa797c45f1D27BE758e20',
'0xABAF8271abc797142Aa1CB14869FD178B8aE02A9','0xcD37B73cF1635Dc355faD7EF7586E58Ab795C068','0x2e60fB137bB86449D5b9CFAfA82E213661d7B30F','0x7A825704788e6ca1bfA7bae83311512CEd538a16',
'0xe53a873FEba4DE138E09E66EbE8EAB2A6e589514','0x6F390F6ca9857d20143399722D0E827744eAF8F0','0x05aB0507A030629138002d9a5a77432968201511','0x1c1Ca177cEA4239f4DeaC98Bdb117Bf73703caE2',
'0xB77dcF8E3B17bFC41a41BC27253bABe8b0C14C6b','0xB91019BA2DC99Ee387dc7EAb12e4f81c61B7eF34','0x47CE7C129B058389dadD095a8d9fd7fd894deEeF','0xeF5D8225B8c991a7F334e6a10aB03A2A1b0EA48D','0x9686CD65A0E998699fAF938879Fb7dB5B79bdCb9','0x9FA51fEA373ACbAB147F4209a14690250b29cd8D','0x33d1b50eAa6BF2f03b128Bee05B3642F50d00903','0x368e4195F8Ee961EEe7b59A33aa328AbFCb02dF2','0xAa6ba56A0b7dd9f15fbEf06E9D361854778F27c9','0x3f22aED1c54db886d2b4Df10900f1B8ED883fC2b','0x245931ee65739d0908d81FfECb6b804B90A552fe','0xdE507f66c5865980b7ffCC7beAe0D332eac2CE49','0xEf115ec43abd4328cf25Df86e5B5729C1CA86294','0x633F42238022BedFdc5Fe1E9645AE325c140F308','0xbb235bB762d76BdCf2698c40E078a46D06367156','0xB1688248DC749704eCA8cAEc6538B74AC3E84cF7','0x0f81a7ffA615c909CCc7C4250C39af335e827Ecd','0x0e3009c85fd825B6A32E14c6C62b04e282455c2f','0xDA34Caeb6369329eBB5e42f010de6E400b4b425b','0xC73290bB97Daac511E0f751Cd80119b3DcA41aec','0x338eFa384C2d93C6880eD5d1406F6baE4f3E9226']
accum = [3] * 10
while True:
    try:
        txs = matic.eth.get_block('latest', full_transactions=True)['transactions']
        gas_list = []
        for tx in txs:
            gas_list.append(tx['gasPrice'] / 10 ** 9)
        gas_list.sort()
        print("gas_list", gas_list)
        accum.append(np.quantile(gas_list, .5))
        gas = np.quantile(accum, .8)
        print(gas)
        with open("gas.txt", "w") as f:
            f.write(str(gas))
        accum.pop(0)
        time.sleep(2)
    except Exception as e:
        print(e)
